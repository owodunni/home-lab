---
# Kubernetes Dashboard configuration
# Official kubernetes-dashboard Helm chart (NOT bjw-s app-template)

app:
  # Ingress configuration
  ingress:
    enabled: true
    # Use Traefik as ingress controller
    ingressClassName: traefik
    useDefaultIngressClass: false
    # Disable default nginx annotations, use Traefik-specific ones
    useDefaultAnnotations: false
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      cert-manager.io/cluster-issuer: letsencrypt-prod
    hosts:
      - dashboard.jardoole.xyz
    path: /
    pathType: Prefix
    # TLS configuration with cert-manager
    issuer:
      name: letsencrypt-prod
      scope: cluster  # Uses cluster-issuer
    tls:
      enabled: true
      secretName: kubernetes-dashboard-tls
    labels: {}

# Kong API gateway configuration
# Enable with resource limits to satisfy ResourceQuota requirements
kong:
  enabled: true

  # Resource limits for proxy container (required by ResourceQuota)
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

  # Init container resource limits (required by ResourceQuota)
  initContainers:
    clear-stale-pid:
      resources:
        requests:
          cpu: 10m
          memory: 16Mi
        limits:
          cpu: 50m
          memory: 32Mi

# Service configuration
service:
  type: ClusterIP
  externalPort: 443

# Resource limits
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi

# Metrics scraper sidecar
metricsScraper:
  enabled: true
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 50m
      memory: 64Mi

# Dashboard settings
settings:
  clusterName: "Home Lab K3s"
  itemsPerPage: 25
  logsAutoRefreshTimeInterval: 5
  resourceAutoRefreshTimeInterval: 5
  disableAccessDeniedNotifications: false

# RBAC settings
rbac:
  create: true
  clusterReadOnlyRole: false
  clusterAdminRole: true  # Full admin access

# Service account
serviceAccount:
  create: true
  name: kubernetes-dashboard

# Pod security context
podSecurityContext:
  runAsUser: 1001
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

# Container security context
containerSecurityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsUser: 1001
  runAsNonRoot: true
  capabilities:
    drop:
      - ALL
